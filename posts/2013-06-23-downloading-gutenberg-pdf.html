<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Downloading Project Gutenberg E-Books as pdf</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
	<link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="alternate" type="application/rss+xml" title="Blog" href="../rss.xml" />
    </head>
    <body>
        <div id="header">
        <img src="../images/header.jpg" alt="header" />
        </div>

        <div id="navigation">
            <p><h2 class="rounded">Warwick Masson</h2></p>
            <p><a href="../" class="rounded">Home</a></p>
            <p><a href="../posts.html" class="rounded">Posts</a></p>
	    <p><a href="../tags.html" class="rounded">Tags</a></p>
            <p><a href="../about.html" class="rounded">About</a></p>
	    <p><a href="../rss.xml" class="rounded">RSS</a></p>
        </div>
        <div id="content"><h2>Downloading Project Gutenberg E-Books as pdf</h2>

<p>On <strong>June 23, 2013</strong></p>

<p><a href="http://www.gutenberg.org">Project Gutenberg</a> is a collection of public domain E-books. The ebooks come as html, epub, txt, and mobi formats. I personally prefer pdf, so I decided to write a script to download an html version and convert it to an equivalent pdf version. This is better than just copying it into a word document or similar as it retains the markup from the original page and includes images. The script is <a href="../files/gutenberg.sh">here</a>. The usage is:</p>
<pre><code>./gutenberg.sh &lt;gutenberg_html_url&gt; &lt;name_of_file&gt;</code></pre>
<p>The first part of the script mkdirs a temporary directory gutenberg_temp. This is because the script produces a number of html files, as well as the images. Next, we download the desired Gutenburg html file with wget:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">filename=$(</span><span class="kw">basename</span> <span class="ot">$1)</span>
<span class="kw">wget</span> -p -k -nd <span class="ot">$filename</span></code></pre>
<p>This downloads all required items like images (-p), converts all links to local ones (-k), and does it all in the local directory (-nd). I’m using <a href="http://johnmacfarlane.net/pandoc/">pandoc</a> to convert the html file to a pdf. However, this won’t work with .gif files, so all of these need to be converted to .png files.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">file</span> in *.gif
<span class="kw">do</span>
    <span class="ot">base=</span><span class="st">&quot;</span><span class="ot">${file%</span>.*<span class="ot">}</span><span class="st">&quot;</span>
    <span class="kw">convert</span> <span class="ot">$file</span> <span class="ot">$base</span>.png
<span class="kw">done</span></code></pre>
<p>Also, we need to replace all references in the html file to .gif with .png. So</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sed</span> -i <span class="st">'s/\.gif/\.png/'</span> <span class="ot">$filename</span></code></pre>
<p>which does the replacing. This might cause problems with some files that talk about .gif files, but that won’t happen with such old books. The html versions are encoded in iso-8859-1, but pandoc requires utf-8 so we’ll use iconv to convert it.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> <span class="ot">$filename</span> -f iso-8859-1 -t utf-8 -o temp<span class="ot">$filename</span></code></pre>
<p>Finally, we need to convert the document. In order to manage certain kinds of characters, we need to set the latex-engine for pandoc to use xelatex. This is because the default, pdflatex, can’t convert characters like umlauts. So we call pandoc,</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">pandoc</span> --latex-engine=xelatex temp<span class="ot">$filename</span> -o ../<span class="ot">$2</span>.pdf</code></pre>
<p>which puts the document into the original directory. Finally, we call cleanup by deleting the gutenberg_temp directory.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> ..
<span class="kw">rm</span> -rf gutenberg_temp</code></pre>
<p>which finishes the script. Note that gutenberg has guidelines about abusing downloading, so don’t use this for batch downloading many documents at once from gutenberg.org..</p>

<p>Tags: <a href="../tags/bash.html">bash</a>.</p>
</div>
        <div id="footer">
            <p>This site generated using <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
            Background by <a href="http://subtlepatterns.com/cubes">Sander Ottens</a>.</p>
        </div>
    </body>
    <script type="text/javascript">

</script>
</html>
